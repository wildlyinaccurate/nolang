(function(b){var a=!!~navigator.userAgent.indexOf(" AppleWebKit/");b.fn.console=function(N){var E={37:q,39:x,38:ad,40:w,8:W,46:z,35:j,36:G,13:K,18:F,9:Z};var Q={65:G,69:j,68:z,78:w,80:ad,66:q,70:x,75:I};if(N.ctrlCodes){b.extend(Q,N.ctrlCodes)}var k={70:X,66:H,68:p};var af={13:Y};var h='<span class="jquery-console-cursor">&nbsp;</span>';var J=b(this);var D=b('<div class="jquery-console-inner"></div>');var T=b('<textarea class="jquery-console-typer"></textarea>');var c;var R;var ae=N&&N.continuedPromptLabel?N.continuedPromptLabel:"> ";var S=0;var n="";var O="";var g="";var M=N.fadeOnReset!==undefined?N.fadeOnReset:true;var o=[];var u=0;var P=0;var ac=true;var aa=false;var V={};(function(){V.promptLabel=N&&N.promptLabel?N.promptLabel:"> ";J.append(D);D.append(T);T.css({position:"absolute",top:0,left:"-9999px"});if(N.welcomeMessage){l(N.welcomeMessage,"jquery-console-welcome")}y();if(N.autofocus){D.addClass("jquery-console-focus");T.focus();setTimeout(function(){D.addClass("jquery-console-focus");T.focus()},100)}V.inner=D;V.typer=T;V.scrollToBottom=ab})();V.reset=function(){var ah=(typeof N.welcomeMessage!="undefined");var ag=function(){D.find("div").each(function(){if(!ah){b(this).remove()}else{ah=false}})};if(M){D.parent().fadeOut(function(){ag();y();D.parent().fadeIn(m)})}else{ag();y();m()}};var m=function(){D.addClass("jquery-console-focus");T.focus()};V.focus=function(){m()};V.notice=function(ak,ai){var al=b('<div class="notice"></div>').append(b("<div></div>").text(ak)).css({visibility:"hidden"});J.append(al);var aj=true;if(ai=="fadeout"){setTimeout(function(){al.fadeOut(function(){al.remove()})},4000)}else{if(ai=="prompt"){var ag=b('<br/><div class="action"><a href="javascript:">OK</a><div class="clear"></div></div>');al.append(ag);aj=false;ag.click(function(){al.fadeOut(function(){al.remove();D.css({opacity:1})})})}}var ah=al.height();al.css({height:"0px",visibility:"visible"}).animate({height:ah+"px"},function(){if(!aj){D.css({opacity:0.5})}});al.css("cursor","default");return al};function y(){S=0;n="";u=0;i();c=b('<div class="jquery-console-prompt-box"></div>');var ag=b('<span class="jquery-console-prompt-label"></span>');var ah=V.continuedPrompt?ae:V.promptLabel;c.append(ag.text(ah).show());ag.html(ag.html().replace(" ","&nbsp;"));R=b('<span class="jquery-console-prompt"></span>');c.append(R);D.append(c);f()}J.click(function(){if(window.getSelection().toString()){return false}D.addClass("jquery-console-focus");D.removeClass("jquery-console-nofocus");if(a){T.focusWithoutScrolling()}else{T.css("position","fixed").focus()}ab();return false});T.blur(function(){D.removeClass("jquery-console-focus");D.addClass("jquery-console-nofocus")});T.bind("paste",function(ag){T.val("");setTimeout(function(){T.consoleInsert(T.val());T.val("")},0)});T.keydown(function(ah){P=0;var ag=ah.keyCode;if(ah.ctrlKey&&ag==67){P=ag;A();return false}if(ac){if(ah.shiftKey&&ag in af){P=ag;(af[ag])();return false}else{if(ah.altKey&&ag in k){P=ag;(k[ag])();return false}else{if(ah.ctrlKey&&ag in Q){P=ag;(Q[ag])();return false}else{if(ag in E){P=ag;(E[ag])();return false}}}}}});T.keypress(function(ah){var ag=ah.keyCode||ah.which;if(s(ah)){return false}if((ah.ctrlKey||ah.metaKey)&&String.fromCharCode(ag).toLowerCase()=="v"){return true}if(ac&&P!=ag&&ag>=32){if(P){return false}if(typeof N.charInsertTrigger=="undefined"||(typeof N.charInsertTrigger=="function"&&N.charInsertTrigger(ag,n))){T.consoleInsert(ag)}}if(a){return false}});function s(ag){return((ag.keyCode==E.tab||ag.keyCode==192)&&ag.altKey)}function d(ah){if(o.length==0){return}u+=ah;if(u<0){u=o.length}else{if(u>o.length){u=0}}var ag=n;if(u==0){n=O}else{n=o[u-1]}if(N.historyPreserveColumn){if(n.length<S+1){S=n.length}else{if(S==0){S=n.length}}}else{S=n.length}f()}function ad(){d(-1)}function w(){d(1)}function r(ag){o.push(ag);O=""}function B(){if(S<n.length){n=n.substring(0,S)+n.substring(S+1);O=n;return true}else{return false}}function W(){if(L(-1)){B();f()}}function z(){if(B()){f()}}function I(){while(B()){f()}}function p(){while(S<n.length&&!v(n[S])){B();f()}while(S<n.length&&v(n[S])){B();f()}}function Y(){var ah=n.split("\n");var ag=ah.slice(-1)[0];var ai=ag.match(/^(\s*)/g)[0];var aj="\n"+ai;n+=aj;L(aj.length);f()}function K(){var ag=n;if(typeof N.commandValidate=="function"){var ah=N.commandValidate(ag);if(ah==true||ah==false){if(ah){e()}}else{C(ah,"jquery-console-message-error")}}else{e()}}function ab(){var ag=jQuery.fn.jquery.split(".");var ah=parseInt(ag[0]);var ai=parseInt(ag[1]);if((ah==1&&ai>6)||ah>1){D.prop({scrollTop:D.prop("scrollHeight")})}else{D.attr({scrollTop:D.attr("scrollHeight")})}}function A(){if(typeof N.cancelHandle=="function"){N.cancelHandle()}}function e(){if(typeof N.commandHandle=="function"){U();r(n);var ah=n;if(V.continuedPrompt){if(g){g+="\n"+n}else{g=n}}else{g=undefined}if(g){ah=g}var ag=N.commandHandle(ah,function(ai){C(ai)});if(V.continuedPrompt&&!g){g=n}if(typeof ag=="boolean"){if(ag){C()}else{C("Command failed.","jquery-console-message-error")}}else{if(typeof ag=="string"){C(ag,"jquery-console-message-success")}else{if(typeof ag=="object"&&ag.length){C(ag)}else{if(V.continuedPrompt){C()}}}}}}function U(){ac=false}function i(){ac=true}function C(aj,ai){S=-1;f();if(typeof aj=="string"){l(aj,ai)}else{if(b.isArray(aj)){for(var ag in aj){var ah=aj[ag];l(ah.msg,ah.className)}}else{D.append(aj)}}y()}function l(ai,ah){var ag=b('<div class="jquery-console-message"></div>');if(ah){ag.addClass(ah)}ag.filledText(ai).hide();D.append(ag);ag.show()}T.consoleInsert=function(ah){var aj=(typeof ah=="number")?String.fromCharCode(ah):ah;var ag=n.substring(0,S);var ai=n.substring(S);n=ag+aj+ai;L(aj.length);O=n;f()};function L(ag){if(S+ag>=0&&S+ag<=n.length){S+=ag;return true}else{return false}}function x(){if(L(1)){f();return true}return false}function q(){if(L(-1)){f();return true}return false}function G(){if(L(-S)){f()}}function j(){if(L(n.length-S)){f()}}function X(){while(S<n.length&&!v(n[S])&&x()){}while(S<n.length&&v(n[S])&&x()){}}function H(){while(S-1>=0&&!v(n[S-1])&&q()){}while(S-1>=0&&v(n[S-1])&&q()){}}function v(ah){if(typeof ah=="string"){var ag=ah.charCodeAt();return(ag>="A".charCodeAt()&&ag<="Z".charCodeAt())||(ag>="a".charCodeAt()&&ag<="z".charCodeAt())||(ag>="0".charCodeAt()&&ag<="9".charCodeAt())}return false}function Z(){if(typeof N.completeHandle=="function"){var ap=N.completeHandle(n);var an=ap.length;if(an===1){V.promptText(n+ap[0])}else{if(an>1&&N.cols){var ag=n;var ao=0;for(var am=0;am<an;am++){ao=Math.max(ao,ap[am].length)}ao+=2;var ah=Math.floor(N.cols/ao);var al="";var ai=0;for(am=0;am<an;am++){var aj=ap[am];al+=ap[am];for(var ak=aj.length;ak<ao;ak++){al+=" "}if(++ai>=ah){al+="\n";ai=0}}C(al,"jquery-console-message-value");V.promptText(ag)}}}}function F(){}V.promptText=function(ag){if(typeof ag==="string"){n=ag;S=n.length;f()}return n};function f(){var ag=n;var ah="";if(S>0&&ag==""){ah=h}else{if(S==n.length){ah=t(ag)+h}else{var ai=ag.substring(0,S);var aj=ag.substring(S,S+1);if(aj){aj='<span class="jquery-console-cursor">'+t(aj)+"</span>"}var ak=ag.substring(S+1);ah=t(ai)+aj+t(ak)}}R.html(ah);ab()}function t(ag){return(ag.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/</g,"&lt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />"))}return V};b.fn.filledText=function(c){b(this).text(c);b(this).html(b(this).html().replace(/\n/g,"<br/>"));return this};b.fn.focusWithoutScrolling=function(){var c=window.scrollX,d=window.scrollY;b(this).focus();window.scrollTo(c,d)}})(jQuery);
